# Tennis Action Analysis Configuration

# Paths
paths:
  input_video: "data/input/tennis_match.mp4"
  output_dir: "data/output"
  models_dir: "weights"
  # Fine-tuned model loaded from HuggingFace: Davidsv/CourtSide-Computer-Vision-v1
  # Set to a local .pt path to skip HuggingFace download
  yolo_weights: null
  action_classifier_weights: "weights/action_classifier.pth"
  pose_weights: "weights/pose_estimator.pth"

# YOLO Detection
# Uses fine-tuned model (HuggingFace) for ball/racket + generic YOLO for players
yolo:
  model_version: "yolov8"  # Version du modèle générique pour détection joueurs
  model_size: "m"  # n, s, m, l, x
  conf_threshold: 0.2  # Bas pour détecter la petite balle
  iou_threshold: 0.45
  device: "cpu"  # cuda or cpu (use cpu for Mac)
  imgsz: 640
  classes:
    0: "person"  # Joueurs (YOLO générique COCO)
    32: "sports_ball"  # Balle (modèle fine-tuné, mappé vers COCO ID)

# Tracking (ByteTrack via roboflow/trackers 2.2.0)
tracking:
  tracker_type: "bytetrack"
  lost_track_buffer: 30               # Frames to keep a lost track
  track_activation_threshold: 0.5     # Min confidence to activate a new track
  minimum_consecutive_frames: 2       # Min consecutive frames before track is confirmed
  minimum_iou_threshold: 0.1          # Min IoU for matching
  high_conf_det_threshold: 0.4        # Threshold for high-confidence detections
  filter_classes: [0, 32]             # Track players and ball
  min_track_length: 30                # Minimum frames for a valid track
  max_person_tracks: 2                # Maximum 2 players

# Action Recognition
action_recognition:
  model_type: "x3d"  # x3d or slowfast
  model_size: "m"  # s, m, l
  num_classes: 6
  clip_duration: 32  # frames
  clip_stride: 8  # frames between clips
  temporal_window: 64  # frames to consider for action
  conf_threshold: 0.2  # Very low to get more detections in simulation mode
  classes:
    - "forehand"
    - "backhand"
    - "slice"
    - "serve"
    - "smash"
    - "volley"

# Pose Estimation
pose:
  enabled: false  # Disabled for speed
  model_type: "hrnet"
  conf_threshold: 0.3
  keypoints: 17

# Video Processing
video:
  fps: 30
  resize_width: 1280
  resize_height: 720
  codec: "mp4v"
  output_fps: 30

# Clip Extraction
clips:
  enabled: false  # Disabled to speed up processing
  margin_frames: 16  # frames before and after action
  min_clip_length: 16
  max_clip_length: 96
  output_format: "mp4"

# Visualization
visualization:
  show_bbox: true
  show_track_id: true
  show_action_label: true
  show_confidence: true
  show_pose: false
  bbox_thickness: 2
  font_scale: 0.6
  font_thickness: 2
  colors:
    player: [0, 255, 0]
    ball: [255, 255, 0]
    racket: [255, 0, 255]
    action_text: [255, 255, 255]

# Training
training:
  batch_size: 8
  num_epochs: 50
  learning_rate: 0.001
  weight_decay: 0.0001
  lr_scheduler: "cosine"
  warmup_epochs: 5
  num_workers: 4
  pin_memory: true
  grad_clip: 1.0
  save_interval: 5
  val_interval: 1

# Data Augmentation
augmentation:
  horizontal_flip: 0.5
  rotation: 15
  brightness: 0.2
  contrast: 0.2
  saturation: 0.2
  hue: 0.1

# Output
output:
  save_video: true
  save_json: true
  save_csv: true
  save_clips: false
  video_codec: "mp4v"
  json_indent: 2

# Logging
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  log_file: "logs/tennis_analysis.log"
  console_output: true